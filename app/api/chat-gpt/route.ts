// app/api/chat-gpt/route.ts
import { NextRequest, NextResponse } from "next/server";

export async function POST(req: NextRequest) {
  try {
    const { message } = await req.json();

    if (!message || typeof message !== "string") {
      return NextResponse.json(
        { error: "message is required" },
        { status: 400 }
      );
    }

    const apiKey = process.env.OPENAI_API_KEY;
    if (!apiKey) {
      console.error("‚ùå –ù–µ—Ç OPENAI_API_KEY –≤ .env.local");
      return NextResponse.json(
        { error: "Server API key is not configured" },
        { status: 500 }
      );
    }

    const apiRes = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${apiKey}`,
      },
      body: JSON.stringify({
        model: "gpt-4o-mini", // –º–æ–∂–µ—à—å –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π
        messages: [
  {
    role: "system",
    content:  `
–¢—ã ‚Äî —É–º–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ —Å–∞–π—Ç–µ INVISIOO, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ª—é–¥—è–º —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∏–¥–∞–º–∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏.
–û—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –ø—Ä–æ—Å—Ç–æ, –ø–æ–Ω—è—Ç–Ω–æ –∏ –∫–æ—Ä–æ—Ç–∫–æ.

–¢–≤–æ–∏ –∑–∞–¥–∞—á–∏:

1) –ü–æ–º–æ–≥–∞—Ç—å —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –ø–æ –≥–æ—Ä–æ–¥—É –∏ –æ–±—ä—è—Å–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∑–Ω–∞—á–∫–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
2) –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç (–∫–æ–ª—è—Å–∫–∞, —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏–µ, —Å–ª–∞–±–æ—Å–ª—ã—à–∞—â–∏–µ, –û–î–ê, –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç—Ä–∞–≤–º–∞, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏).
3) –û–±—ä—è—Å–Ω—è—Ç—å —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤: –ø–∞–Ω–¥—É—Å—ã, –ª–∏—Ñ—Ç—ã, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, —Ç—É–∞–ª–µ—Ç—ã, —à–∏—Ä–∏–Ω–∞ –ø—Ä–æ—Ö–æ–¥–æ–≤, —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–µ –ø–æ–ª–æ—Å—ã –∏ —Ç.–ø.
4) –ü–æ–º–æ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –º–µ—Å—Ç–æ, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –µ–≥–æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö.
5) –î–∞–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Äî —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã.
6) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –º–∞—Ä—à—Ä—É—Ç ‚Äî –¥–∞–≤–∞–π —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏, –∫–∞–∫ –ª—É—á—à–µ –¥–æ–±—Ä–∞—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.

7) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ —Ä–∞–±–æ—Ç—É, –Ω–∞–≤—ã–∫–∏, –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, —Ä–µ–∑—é–º–µ –∏–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–∏:
   - –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π, —á—Ç–æ –Ω–∞ —Å–∞–π—Ç–µ INVISIOO –µ—Å—Ç—å —Ä–∞–∑–¥–µ–ª ¬´–í–∞–∫–∞–Ω—Å–∏–∏¬ª (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ /vacancies),
   - –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏,
   - –ù–ï —É–ø–æ–º–∏–Ω–∞–π —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–∞–π—Ç—ã ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞—à —Å–∞–π—Ç,
   - –ø–æ–º–æ–≥–∞–π —Å —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ –Ω–∞–≤—ã–∫–∞–º, –≤—ã–±–æ—Ä—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é —Ä–µ–∑—é–º–µ,
   - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–π —Ñ—Ä–∞–∑—É –≤—Ä–æ–¥–µ:
     ¬´–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ INVISIOO –≤ —Ä–∞–∑–¥–µ–ª–µ ‚Äú–í–∞–∫–∞–Ω—Å–∏–∏‚Äù.¬ª

8) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç ¬´—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å?¬ª:
   - –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—á–∏—Å–ª—è–π:
     ‚Ä¢ –ø–æ–º–æ—â—å —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π  
     ‚Ä¢ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–∫–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏  
     ‚Ä¢ —Å–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç  
     ‚Ä¢ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º  
     ‚Ä¢ –ø–æ–º–æ—â—å —Å –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏  
     ‚Ä¢ –ø–æ–º–æ—â—å —Å –Ω–∞–≤—ã–∫–∞–º–∏  
     ‚Ä¢ –ø–æ–º–æ—â—å –≤ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Ä–µ–∑—é–º–µ  
     ‚Ä¢ –Ω–∞–ª–∏—á–∏–µ —Ä–∞–∑–¥–µ–ª–∞ ‚Äú–í–∞–∫–∞–Ω—Å–∏–∏‚Äù –Ω–∞ —Å–∞–π—Ç–µ INVISIOO  
   - –æ—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

–ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è:
- –ü–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ–ª–µ–∑–Ω–æ.
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã.
- –í—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞–π —Ç–∏–ø –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –µ–≥–æ —É–∫–∞–∑–∞–ª.
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≥–æ–≤–æ—Ä–∏ ¬´—É –º–µ–Ω—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É¬ª.
- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã.
- –û—Ç–≤–µ—á–∞–π –ø–æ–∑–∏—Ç–∏–≤–Ω–æ, –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ –ø–æ –¥–µ–ª—É.

–¢—ã ‚Äî –¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, —Ü–µ–ª—å –∫–æ—Ç–æ—Ä–æ–≥–æ ‚Äî –ø–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ INVISIOO.


`,
  },
  {
    role: "user",
    content: message,
  },
],

        temperature: 0.4,
      }),
    });

    if (!apiRes.ok) {
      const errText = await apiRes.text();
      console.error("OpenAI API error:", errText);
      return NextResponse.json(
        { error: "Failed to call OpenAI" },
        { status: 500 }
      );
    }

    const data = await apiRes.json();

    const answer =
      data.choices?.[0]?.message?.content ??
      "–Ø –∑–∞—Ç—Ä—É–¥–Ω—è—é—Å—å –æ—Ç–≤–µ—Ç–∏—Ç—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å üôè";

    return NextResponse.json({ answer });
  } catch (e) {
    console.error("GPT route error:", e);
    return NextResponse.json(
      { error: "Internal error" },
      { status: 500 }
    );
  }
}
